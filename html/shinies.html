<link type="text/css" rel="stylesheet" href="./css/shinies.css" />
<script type="text/javascript" language="JavaScript">
    function loadJSON(path, callback) {

        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open("GET", path, true);
        xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
                // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                callback(xobj.responseText);
            }
        };
        xobj.send(null);
    }

    loadJSON("html/shinies.json", response => {
        // Parse JSON string into object
        const actual_JSON = JSON.parse(response);

        //******** DEFS ********
        const div_elements = [
            "poke-id",
            "poke-current-level",
            "poke-received-in",
            "poke-received-by",
            "poke-ot-name",
            "poke-ot-id",
            "poke-current-location",
            "poke-note"
        ];

        const shinies = actual_JSON.shinies;
        const all_versions = actual_JSON.versions;
        const received_by = actual_JSON.received_by;

        //******** DRAW ********
        div = document.createElement("div");
        div.classList.add("poke-wrapper");
        document.querySelector("#content").appendChild(div);

        for (let shiny_i in shinies) {
            let div, div2;

            const shiny = shinies[shiny_i];

            /* console.log(shiny);
            console.log("#" + shiny.id);
            console.log("Erhalten in: " + shiny.received_in);
            console.log("Erhalten durch: " + shiny.received_by);
            console.log("Momentan in: " + shiny.current_location);
            console.log("Aktuelles Level " + shiny.current_level);
            console.log("OT: " + shiny.ot_name);
            console.log("ID: " + shiny.ot_id);
            console.log("Anmerkung: " + shiny.note); */

            //******** CREATE DOM STRUCTURE ********
            div = document.createElement("div");
            div.classList.add("poke-elem");
            document.querySelector(".poke-wrapper").appendChild(div);
            /* document.body.appendChild(div); */

            for (let element_i in div_elements) {
                div2 = document.createElement("div");
                div2.classList.add(div_elements[element_i]);
                div.appendChild(div2);
            }

            //******** FILL DOM WITH DATA ********
            div2 = div.querySelector(".poke-id");
            if (div2 && shiny.id !== ("" && undefined && null)) {
                div2.classList.add(shiny.id);
                let html = "Pok&eacute;dex No. " + shiny.id;
                html += "<br/><img src=\"https://www.serebii.net/Shiny/SM/" + shiny.id + ".png\">";
                div2.innerHTML = html;
            }

            div2 = div.querySelector(".poke-current-level");
            if (div2) {
                let html = "";
                if (shiny.gender && shiny.gender != "") {
                    if (shiny.gender === "m") {
                        html += "<img src=\"img/male.gif\">";
                    } else if (shiny.gender === "f") {
                        html += "<img src=\"img/female.gif\">";

                    }
                }
                html += " Lv.";
                if (shiny.current_level !== ("" && undefined && null)) {
                    div2.classList.add(shiny.current_level);
                    html += shiny.current_level;
                } else {
                    html += "?";
                }
                div2.innerHTML = html;
            }

            div2 = div.querySelector(".poke-received-in");
            if (div2 && shiny.received_in !== ("" && undefined && null)) {
                div2.classList.add(shiny.received_in);
                let html = "Erhalten in: ";
                let versions = [];
                for (version in all_versions) {
                    if (all_versions[version].set_code === shiny.received_in) {
                        versions.push(all_versions[version]);
                    }
                }
                if (versions.length > 0) {
                    for (version in versions) {
                        html += "<span class=\"poke-version " + versions[version].css_class;
                        console.log(version);
                        console.log(versions.length);
                        if (version === "0") {
                            html += " poke-version-first";
                        }
                        if (version === (versions.length - 1).toString()) {
                            html += " poke-version-last";
                        }
                        html += "\">";
                        html += versions[version].code;
                        html += "</span>";
                    }
                } else {
                    html += shiny.received_in;
                }
                div2.innerHTML = html;
            }

            div2 = div.querySelector(".poke-received-by");
            if (div2 && shiny.received_by !== ("" && undefined && null)) {
                div2.classList.add(shiny.received_by);
                div2.innerHTML = "Erhalten durch: ";
                div2.innerHTML += received_by[shiny.received_by] ? received_by[shiny.received_by] : shiny.received_by;
            }

            div2 = div.querySelector(".poke-current-location");
            if (div2 && shiny.current_location !== ("" && undefined && null)) {
                div2.classList.add(shiny.current_location);
                let html = "Momentan in: "
                if (all_versions[shiny.current_location]) {
                    html += "<span class=\"poke-version " + all_versions[shiny.current_location].css_class;
                    html += " poke-version-solo";
                    html += "\">";
                    html += all_versions[shiny.current_location].name;
                    html += "</span>";
                } else {
                    html += shiny.current_location;
                }
                div2.innerHTML = html;
            }

            div2 = div.querySelector(".poke-ot-name");
            if (div2 && shiny.ot_name !== ("" && undefined && null)) {
                div2.classList.add(shiny.ot_name);
                div2.innerHTML = "OT: " + shiny.ot_name;
            }

            div2 = div.querySelector(".poke-ot-id");
            if (div2 && shiny.ot_id !== ("" && undefined && null)) {
                div2.classList.add(shiny.ot_id);
                div2.innerHTML = "ID: " + shiny.ot_id;
            }

            div2 = div.querySelector(".poke-note");
            if (div2 && shiny.note !== ("" && undefined && null)) {
                div2.innerHTML = "Anmerkung: " + shiny.note;
            }
        }
    });
</script>